<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0045)http://nolinux.blog.51cto.com/4824967/1591739 -->
<html xmlns="http://www.w3.org/1999/xhtml" style="color: rgb(0, 0, 0); background-color: rgb(204, 232, 207);"><head><meta http-equiv="Content-Type" content="text/html; charset=GBK">




<title>DRBD项目实施之NFS高可用架构（NFS+Heartbeat+Drbd）</title>








<script language="javascript" src="./DRBD项目实施之NFS高可用架构_files/dialog_utf8.js" type="text/javascript"></script>
<link href="./DRBD项目实施之NFS高可用架构_files/31.css" rel="stylesheet" type="text/css">







</head>

<body style="color: rgb(0, 0, 0); background-color: rgb(204, 232, 207);">




















<link rel="stylesheet" type="text/css" href="./DRBD项目实施之NFS高可用架构_files/shCoreDefault.css">





















<div class="blogMain">







<div class="blogRight" rel="4824967######heartbeat linux nfs 高可用" id="article_edu_void">
<input type="hidden" value="8" id="edu_jia">

	
	<style type="text/css">
.vlist {
    float: left;
    padding: 2px 0 0 10px;
    width: 218px;

}
.vlist img {
    float: left;
    margin-right: 10px;
}
.vlist dl {
    float: left;
    text-align: left;
    width: 122px;
}
.vlist dl dt {
    height: 44px;
    overflow: hidden;
    padding-top: 5px;
}
.vlist dl dt, .vlist dl dt a {
    color: #262626;
}
.vlist dl dd, .vlist dl dd a {
    color: #777777;
}
.vbox_tit {
    border-bottom: 1px solid #B3D0E6;
    color: #666666;
    font-size: 14px;
    margin-top: 10px;
    text-align: left;
}
.video-icon {
    position: relative;
}
.video-icon a.i_video {
    background: url("http://www.51cto.com/images/homepage/Images/eduplay.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
    display: block;
    height: 25px;
    left: 41px;
    position: absolute;
    top: 22px;
    width: 25px;
    z-index: 10;
}
.vbox2 .vlist1{margin:0;}
.edu-col-a{ float:left;margin-right:6px;}
.edu-col-b{ float:left;}
	</style>
	<div class="artShow box" style="margin-top:5px;">
   	  <div class="share" id="share">

    <div class="shareItem">
		<div class="m_sharelinks"><a target="_blank" href="http://nolinux.blog.51cto.com/4824967/1591739" style="color:red;"></a><a target="_blank" href="http://nolinux.blog.51cto.com/4824967/1591739" style="color:blue;"></a><a target="_blank" href="http://nolinux.blog.51cto.com/4824967/1591739" style="color:blue;"></a></div>
		
	</div>
      </div>
       <div class="modCon">
   	  <div class="showBox" style="margin:0 0 10px;">
      
      


    		<div class="showHead">
    		  <div class="showTitleBOx" style="text-align:center">
              <div class="showTitle">

             <img src="./DRBD项目实施之NFS高可用架构_files/artType01.jpg">


    		    DRBD项目实施之NFS高可用架构（NFS+Heartbeat+Drbd）
                </div>
  		    </div>
   		    </div>
    

			


            


		  <div class="showContent">
    		  <p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp;由于目前线上的两台NFS服务器，一台为主，一台为备。主到备的数据同步，靠rsync来做。由于数据偏重于图片业务，并且还是千万级的碎图片。在目前的业务框架下，NFS服务是存在单点的，并且数据的同步也不能做完全实时性，从而导致不能确保一致性。因此，出于对业务在线率和数据安全的保障，目前需要一套新的架构来解决 NFS 服务单点和数据实时同步的问题。</span></p><p><br></p><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:16px;"><strong><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(255,0,0);">架构拓扑<strong style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;line-height:24px;white-space:normal;"><span style="line-height:1.5;color:rgb(255,0,0);">：</span></strong></span></strong></span></p><p><img onload="if(this.width&gt;650) this.width=650;" src="./DRBD项目实施之NFS高可用架构_files/spacer.gif" style="background:url(&quot;/e/u261/lang/zh-cn/images/localimage.png&quot;) no-repeat center;border:1px solid #ddd;" alt="spacer.gif" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><a href="./DRBD项目实施之NFS高可用架构_files/wKioL1STyX6CnrLpAACcVZFTQ74844.jpg" style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;line-height:21px;white-space:normal;" target="_blank"><img onload="if(this.width&gt;650) this.width=650;" src="./DRBD项目实施之NFS高可用架构_files/wKioL1STyX6CnrLpAACcVZFTQ74844.jpg" title="clipboard.png" alt="wKioL1STyX6CnrLpAACcVZFTQ74844.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></a></p><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:16px;"><strong><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(255,0,0);font-size:16px;">简单描述：</span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;line-height:21px;">&nbsp; &nbsp; &nbsp; &nbsp;</span>两台 NFS 服务器，通过 em1 网卡与内网的其他业务服务器进行通信，em2网卡主要负责两台 NFS 服务器之间心跳通信，em3网卡主要负责drbd数据同步的传输。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;line-height:21px;">&nbsp; &nbsp; &nbsp; &nbsp;</span>前面的2台图片服务器通过 NFS 集群提供出来的一个VIP 192.168.0.219 来使用 NFS 集群服务。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;color:rgb(0,0,0);background-color:inherit;"><strong style="background-color:inherit;"><br></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">一、项目基础设施及信息介绍</strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);background-color:inherit;">1、设备信息</span></strong></span></p><div><div id="highlighter_803542" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">现有的两台&nbsp;NFS&nbsp;存储服务器的硬件配置信息：</code></div><div class="line number2 index1 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">CPU：&nbsp;&nbsp;Intel(R)&nbsp;Xeon(R)&nbsp;CPU&nbsp;E5-2609&nbsp;0&nbsp;@&nbsp;2.40GHz</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">MEM：&nbsp;16G</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">Raid：&nbsp;RAID&nbsp;1</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">Disk：&nbsp;SSD&nbsp;200G&nbsp;x&nbsp;2</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">网卡：集成的&nbsp;4&nbsp;个千兆网卡&nbsp;Link&nbsp;is&nbsp;up&nbsp;at&nbsp;1000&nbsp;Mbps,&nbsp;full&nbsp;duplex&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">前端两台静态图片服务器硬件配置信息：</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">略</code></div></div></td></tr></tbody></table></div></div><p style="font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"></span><br></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">2、网络</span></strong></span></p><p style="font-family:&#39;微软雅黑&#39;;font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"></span></p><div><div id="highlighter_42046" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">浮动&nbsp;VIP&nbsp;:&nbsp;192.168.0.219&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;漂浮在M1和M2上，负责对外提供服务</code></div><div class="line number2 index1 alt1"><code class="bash plain">现有的两台&nbsp;NFS&nbsp;存储服务器的网络配置信息：</code></div><div class="line number3 index2 alt2"><code class="bash plain">主机名：M1.redhat.sx</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">em1：192.168.0.210&nbsp;&nbsp;&nbsp;&nbsp;内网</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">em2：172.16.0.210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;心跳线</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">em3：172.16.100.210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRBD千兆数据传输</code></div><div class="line number7 index6 alt2"><code class="bash plain">主机名：M2.redhat.sx</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">em1：192.168.0.211&nbsp;&nbsp;&nbsp;&nbsp;内网</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">em2：172.16.0.211&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;心跳线</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">em3：172.16.100.211&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRBD千兆数据传输</code></div></div></td></tr></tbody></table></div></div><p style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, sans-serif;color:rgb(0,0,0);font-size:14px;background-color:inherit;"></span><br></p><p><br style="background-color:inherit;"></p><p style="font-family:&#39;微软雅黑&#39;;font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">3、系统环境&nbsp;</span></strong></span></p><div><div id="highlighter_724002" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">内核版本：2.6.32-504.el6.x86_64</code></div><div class="line number2 index1 alt1"><code class="bash plain">系统版本：CentOS&nbsp;6.5</code></div><div class="line number3 index2 alt2"><code class="bash plain">系统位数：x86_64</code></div><div class="line number4 index3 alt1"><code class="bash plain">防火墙规则清空</code></div><div class="line number5 index4 alt2"><code class="bash plain">selinux关闭</code></div></div></td></tr></tbody></table></div></div><p style="font-size:14px;"><br style="background-color:inherit;"></p><p style="font-size:14px;"><br></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">4、软件版本</span></strong></span></p><div><div id="highlighter_412606" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">heartbeat-3.0.4-2.el6.x86_64</code></div><div class="line number2 index1 alt1"><code class="bash plain">drbd-8.4.3</code></div><div class="line number3 index2 alt2"><code class="bash plain">rpcbind-0.2.0-11.el6.x86_64</code></div><div class="line number4 index3 alt1"><code class="bash plain">nfs-utils-1.2.3-54.el6.x86_64</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, sans-serif;color:rgb(255,0,0);font-size:4px;background-color:rgb(255,255,255);"><br></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">二、基础服务配置</strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">这里仅以 M1 服务的配置为例，M2 服务器配置与此相同。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">1、配置时间同步</span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_87097" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ntpdate&nbsp;pool.ntp.org&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">12&nbsp;Nov&nbsp;14:45:15&nbsp;ntpdate[27898]:&nbsp;adjust&nbsp;</code><code class="bash functions">time</code>&nbsp;<code class="bash plain">server&nbsp;42.96.167.209&nbsp;offset&nbsp;0.044720&nbsp;sec</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_780048" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ntpdate&nbsp;pool.ntp.org&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">12&nbsp;Nov&nbsp;14:45:06&nbsp;ntpdate[24447]:&nbsp;adjust&nbsp;</code><code class="bash functions">time</code>&nbsp;<code class="bash plain">server&nbsp;42.96.167.209&nbsp;offset&nbsp;0.063174&nbsp;sec</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">2、配置/etc/hosts文件</span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_182710" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/etc/hosts&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">127.0.0.1&nbsp;localhost&nbsp;localhost.localdomain&nbsp;localhost4&nbsp;localhost4.localdomain4&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">::1&nbsp;localhost&nbsp;localhost.localdomain&nbsp;localhost6&nbsp;localhost6.localdomain6&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">192.168.0.210&nbsp;M1.redhat.sx&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">192.168.0.211&nbsp;M2.redhat.sx</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_674335" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/etc/hosts&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">127.0.0.1&nbsp;localhost&nbsp;localhost.localdomain&nbsp;localhost4&nbsp;localhost4.localdomain4&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">::1&nbsp;localhost&nbsp;localhost.localdomain&nbsp;localhost6&nbsp;localhost6.localdomain6&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">192.168.0.210&nbsp;M1.redhat.sx&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">192.168.0.211&nbsp;M2.redhat.sx</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">3、增加主机间路由</span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">首先先验证 M1 和 M2 的服务器 IP 是否合乎规划</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_783082" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ifconfig|egrep&nbsp;'Link&nbsp;encap|inet&nbsp;addr'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;验证现有&nbsp;IP&nbsp;信息</code></div><div class="line number2 index1 alt1"><code class="bash plain">em1&nbsp;Link&nbsp;encap:Ethernet&nbsp;HWaddr&nbsp;B8:CA:3A:F1:00:2F&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;addr:192.168.0.210&nbsp;Bcast:192.168.0.255&nbsp;Mask:255.255.255.0&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">em2&nbsp;Link&nbsp;encap:Ethernet&nbsp;HWaddr&nbsp;B8:CA:3A:F1:00:30&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">inet&nbsp;addr:172.16.0.210&nbsp;Bcast:172.16.0.255&nbsp;Mask:255.255.255.0&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">em3&nbsp;Link&nbsp;encap:Ethernet&nbsp;HWaddr&nbsp;B8:CA:3A:F1:00:31&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">inet&nbsp;addr:172.16.100.210&nbsp;Bcast:172.16.100.255&nbsp;Mask:255.255.255.0&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">lo&nbsp;Link&nbsp;encap:Local&nbsp;Loopback&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">inet&nbsp;addr:127.0.0.1&nbsp;Mask:255.0.0.0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong></span></p><div><div id="highlighter_301298" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ifconfig|egrep&nbsp;'Link&nbsp;encap|inet&nbsp;addr'&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">em1&nbsp;Link&nbsp;encap:Ethernet&nbsp;HWaddr&nbsp;B8:CA:3A:F1:DE:37&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;addr:192.168.0.211&nbsp;Bcast:192.168.0.255&nbsp;Mask:255.255.255.0&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">em2&nbsp;Link&nbsp;encap:Ethernet&nbsp;HWaddr&nbsp;B8:CA:3A:F1:DE:38&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">inet&nbsp;addr:172.16.0.211&nbsp;Bcast:172.16.0.255&nbsp;Mask:255.255.255.0&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">em3&nbsp;Link&nbsp;encap:Ethernet&nbsp;HWaddr&nbsp;B8:CA:3A:F1:DE:39&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">inet&nbsp;addr:172.16.100.211&nbsp;Bcast:172.16.100.255&nbsp;Mask:255.255.255.0&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">lo&nbsp;Link&nbsp;encap:Local&nbsp;Loopback&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">inet&nbsp;addr:127.0.0.1&nbsp;Mask:255.0.0.0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">查看现有路由，然后增加相应的心跳线和drbd数据传输线路的端到端的静态路由条目。目的是为了让心跳检测和数据同步不受干扰。</span></p><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="background-color:inherit;"><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong></span></p><div><div id="highlighter_345611" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;route&nbsp;-n&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Kernel&nbsp;IP&nbsp;routing&nbsp;table&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Destination&nbsp;Gateway&nbsp;Genmask&nbsp;Flags&nbsp;Metric&nbsp;Ref&nbsp;Use&nbsp;Iface&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">172.16.100.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">172.16.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">192.168.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1002&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1003&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1004&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number10 index9 alt1"><code class="bash plain">0.0.0.0&nbsp;192.168.0.1&nbsp;0.0.0.0&nbsp;UG&nbsp;0&nbsp;0&nbsp;0&nbsp;em1</code></div><div class="line number11 index10 alt2"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.0.211&nbsp;dev&nbsp;em2&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.100.211&nbsp;dev&nbsp;em3&nbsp;</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;echo&nbsp;'/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.0.211&nbsp;dev&nbsp;em2'&nbsp;&gt;&gt;&nbsp;/etc/rc.local&nbsp;</code></div><div class="line number14 index13 alt1"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;echo&nbsp;'/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.100.211&nbsp;dev&nbsp;em3'&nbsp;&gt;&gt;&nbsp;/etc/rc.local&nbsp;</code></div><div class="line number15 index14 alt2"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;tail&nbsp;-2&nbsp;/etc/rc.local&nbsp;</code></div><div class="line number16 index15 alt1"><code class="bash plain">/sbin/route</code>&nbsp;<code class="bash plain">add&nbsp;-host&nbsp;172.16.0.211&nbsp;dev&nbsp;em1&nbsp;</code></div><div class="line number17 index16 alt2"><code class="bash plain">/sbin/route</code>&nbsp;<code class="bash plain">add&nbsp;-host&nbsp;172.16.100.211&nbsp;dev&nbsp;em1</code></div><div class="line number18 index17 alt1"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;route&nbsp;-n&nbsp;</code></div><div class="line number19 index18 alt2"><code class="bash plain">Kernel&nbsp;IP&nbsp;routing&nbsp;table&nbsp;</code></div><div class="line number20 index19 alt1"><code class="bash plain">Destination&nbsp;Gateway&nbsp;Genmask&nbsp;Flags&nbsp;Metric&nbsp;Ref&nbsp;Use&nbsp;Iface&nbsp;</code></div><div class="line number21 index20 alt2"><code class="bash plain">172.16.0.211&nbsp;0.0.0.0&nbsp;255.255.255.255&nbsp;UH&nbsp;0&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number22 index21 alt1"><code class="bash plain">172.16.100.211&nbsp;0.0.0.0&nbsp;255.255.255.255&nbsp;UH&nbsp;0&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number23 index22 alt2"><code class="bash plain">172.16.100.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number24 index23 alt1"><code class="bash plain">172.16.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number25 index24 alt2"><code class="bash plain">192.168.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number26 index25 alt1"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1002&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number27 index26 alt2"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1003&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number28 index27 alt1"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1004&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number29 index28 alt2"><code class="bash plain">0.0.0.0&nbsp;192.168.0.1&nbsp;0.0.0.0&nbsp;UG&nbsp;0&nbsp;0&nbsp;0&nbsp;em1</code></div><div class="line number30 index29 alt1"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;traceroute&nbsp;172.16.0.211&nbsp;</code></div><div class="line number31 index30 alt2"><code class="bash functions">traceroute</code>&nbsp;<code class="bash plain">to&nbsp;172.16.0.211&nbsp;(172.16.0.211),&nbsp;30&nbsp;hops&nbsp;max,&nbsp;60&nbsp;byte&nbsp;packets&nbsp;</code></div><div class="line number32 index31 alt1"><code class="bash plain">1&nbsp;172.16.0.211&nbsp;(172.16.0.211)&nbsp;0.820&nbsp;ms&nbsp;0.846&nbsp;ms&nbsp;0.928&nbsp;ms</code></div><div class="line number33 index32 alt2"><code class="bash plain">[root@M1&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;traceroute&nbsp;172.16.100.211&nbsp;</code></div><div class="line number34 index33 alt1"><code class="bash functions">traceroute</code>&nbsp;<code class="bash plain">to&nbsp;172.16.100.211&nbsp;(172.16.100.211),&nbsp;30&nbsp;hops&nbsp;max,&nbsp;60&nbsp;byte&nbsp;packets&nbsp;</code></div><div class="line number35 index34 alt2"><code class="bash plain">1&nbsp;172.16.100.211&nbsp;(172.16.100.211)&nbsp;0.291&nbsp;ms&nbsp;0.273&nbsp;ms&nbsp;0.257&nbsp;ms</code></div></div></td></tr></tbody></table></div></div><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">M2端：</span></strong></span></p><div><div id="highlighter_753935" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;route&nbsp;-n&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Kernel&nbsp;IP&nbsp;routing&nbsp;table&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Destination&nbsp;Gateway&nbsp;Genmask&nbsp;Flags&nbsp;Metric&nbsp;Ref&nbsp;Use&nbsp;Iface&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">172.16.100.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">172.16.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">192.168.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1002&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1003&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1004&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number10 index9 alt1"><code class="bash plain">0.0.0.0&nbsp;192.168.0.1&nbsp;0.0.0.0&nbsp;UG&nbsp;0&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.0.210&nbsp;dev&nbsp;em2&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.100.210&nbsp;dev&nbsp;em3&nbsp;</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;echo&nbsp;'/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.0.210&nbsp;dev&nbsp;em2'&nbsp;&gt;&gt;&nbsp;/etc/rc.local&nbsp;</code></div><div class="line number14 index13 alt1"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;echo&nbsp;'/sbin/route&nbsp;add&nbsp;-host&nbsp;172.16.100.210&nbsp;dev&nbsp;em3'&nbsp;&gt;&gt;&nbsp;/etc/rc.local&nbsp;</code></div><div class="line number15 index14 alt2"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;tail&nbsp;-2&nbsp;/etc/rc.local&nbsp;</code></div><div class="line number16 index15 alt1"><code class="bash plain">/sbin/route</code>&nbsp;<code class="bash plain">add&nbsp;-host&nbsp;172.16.0.210&nbsp;dev&nbsp;em1&nbsp;</code></div><div class="line number17 index16 alt2"><code class="bash plain">/sbin/route</code>&nbsp;<code class="bash plain">add&nbsp;-host&nbsp;172.16.100.210&nbsp;dev&nbsp;em1&nbsp;</code></div><div class="line number18 index17 alt1"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;route&nbsp;-n&nbsp;</code></div><div class="line number19 index18 alt2"><code class="bash plain">Kernel&nbsp;IP&nbsp;routing&nbsp;table&nbsp;</code></div><div class="line number20 index19 alt1"><code class="bash plain">Destination&nbsp;Gateway&nbsp;Genmask&nbsp;Flags&nbsp;Metric&nbsp;Ref&nbsp;Use&nbsp;Iface&nbsp;</code></div><div class="line number21 index20 alt2"><code class="bash plain">172.16.0.210&nbsp;0.0.0.0&nbsp;255.255.255.255&nbsp;UH&nbsp;0&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number22 index21 alt1"><code class="bash plain">172.16.100.210&nbsp;0.0.0.0&nbsp;255.255.255.255&nbsp;UH&nbsp;0&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number23 index22 alt2"><code class="bash plain">172.16.100.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number24 index23 alt1"><code class="bash plain">172.16.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number25 index24 alt2"><code class="bash plain">192.168.0.0&nbsp;0.0.0.0&nbsp;255.255.255.0&nbsp;U&nbsp;0&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number26 index25 alt1"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1002&nbsp;0&nbsp;0&nbsp;em1&nbsp;</code></div><div class="line number27 index26 alt2"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1003&nbsp;0&nbsp;0&nbsp;em2&nbsp;</code></div><div class="line number28 index27 alt1"><code class="bash plain">169.254.0.0&nbsp;0.0.0.0&nbsp;255.255.0.0&nbsp;U&nbsp;1004&nbsp;0&nbsp;0&nbsp;em3&nbsp;</code></div><div class="line number29 index28 alt2"><code class="bash plain">0.0.0.0&nbsp;192.168.0.1&nbsp;0.0.0.0&nbsp;UG&nbsp;0&nbsp;0&nbsp;0&nbsp;em1</code></div><div class="line number30 index29 alt1"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;traceroute&nbsp;172.16.0.210&nbsp;</code></div><div class="line number31 index30 alt2"><code class="bash functions">traceroute</code>&nbsp;<code class="bash plain">to&nbsp;172.16.0.210&nbsp;(172.16.0.210),&nbsp;30&nbsp;hops&nbsp;max,&nbsp;60&nbsp;byte&nbsp;packets&nbsp;</code></div><div class="line number32 index31 alt1"><code class="bash plain">1&nbsp;172.16.0.210&nbsp;(172.16.0.210)&nbsp;0.816&nbsp;ms&nbsp;0.843&nbsp;ms&nbsp;0.922&nbsp;ms</code></div><div class="line number33 index32 alt2"><code class="bash plain">[root@M2&nbsp;network-scripts]</code><code class="bash comments">#&nbsp;traceroute&nbsp;172.16.100.210&nbsp;</code></div><div class="line number34 index33 alt1"><code class="bash functions">traceroute</code>&nbsp;<code class="bash plain">to&nbsp;172.16.100.210&nbsp;(172.16.100.210),&nbsp;30&nbsp;hops&nbsp;max,&nbsp;60&nbsp;byte&nbsp;packets&nbsp;</code></div><div class="line number35 index34 alt2"><code class="bash plain">1&nbsp;172.16.100.210&nbsp;(172.16.100.210)&nbsp;0.256&nbsp;ms&nbsp;0.232&nbsp;ms&nbsp;0.215&nbsp;ms</code></div></div></td></tr></tbody></table></div></div><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">三、部署 heartbe</strong></span><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">at 服务</strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">此处仅演示 M1 服务端的安装，M2 的不做复述。&nbsp;</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">1、安装heartbeat软件</span></strong></span></p><div><div id="highlighter_188775" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cd&nbsp;/etc/yum.repos.d/&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@M1&nbsp;yum.repos.d]</code><code class="bash comments">#&nbsp;wget&nbsp;http://mirrors.163.com/.help/CentOS6-Base-163.repo</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@M1&nbsp;yum.repos.d]</code><code class="bash comments">#&nbsp;rpm&nbsp;-Uvh&nbsp;http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M1&nbsp;yum.repos.d]</code><code class="bash comments">#&nbsp;sed&nbsp;-i&nbsp;'s@#baseurl@baseurl@g'&nbsp;*</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;yum.repos.d]</code><code class="bash comments">#&nbsp;sed&nbsp;-i&nbsp;'s@mirrorlist@#mirrorlist@g'&nbsp;*</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@M1&nbsp;yum.repos.d]</code><code class="bash comments">#&nbsp;yum&nbsp;install&nbsp;heartbeat&nbsp;-y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;该命令有时可能需要执行2次</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">2、配置heartbeat服务</span></strong></span></p><div><div id="highlighter_867612" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;&nbsp;yum.repos.d]</code><code class="bash comments">#&nbsp;cd&nbsp;/usr/share/doc/heartbeat-3.0.4/&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@M1&nbsp;heartbeat-3.0.4]</code><code class="bash comments">#&nbsp;ll&nbsp;|egrep&nbsp;'ha.cf|authkeys|haresources'&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">-rw-r--r--.&nbsp;1&nbsp;root&nbsp;root&nbsp;645&nbsp;Dec&nbsp;3&nbsp;2013&nbsp;authkeys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;heartbeat服务的认证文件</code></div><div class="line number4 index3 alt1"><code class="bash plain">-rw-r--r--.&nbsp;1&nbsp;root&nbsp;root&nbsp;10502&nbsp;Dec&nbsp;3&nbsp;2013&nbsp;ha.cf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;heartbeat服务主配置文件</code></div><div class="line number5 index4 alt2"><code class="bash plain">-rw-r--r--.&nbsp;1&nbsp;root&nbsp;root&nbsp;5905&nbsp;Dec&nbsp;3&nbsp;2013&nbsp;haresources&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;heartbeat资源文件</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@M1&nbsp;heartbeat-3.0.4]</code><code class="bash comments">#&nbsp;cp&nbsp;ha.cf&nbsp;authkeys&nbsp;haresources&nbsp;/etc/ha.d/&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@M1&nbsp;heartbeat-3.0.4]</code><code class="bash comments">#&nbsp;cd&nbsp;/etc/ha.d/</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;ls&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">authkeys&nbsp;ha.cf&nbsp;harc&nbsp;haresources&nbsp;rc.d&nbsp;README.config&nbsp;resource.d&nbsp;shellfuncs</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">注意：</span></strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">主备节点两端的配置文件(ha.cf,authkeys,haresource)完全相同，下面是各个节点的文件内容</span></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">针对heartbeat的配置，主要就是修改ha.cf、authkeys、haresources这三个文件，下面我列出这三个文件的配置信息，大家仅作参考！</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">a、ha.cf 文件</span></strong></span></p><div><div id="highlighter_859540" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/etc/ha.d/ha.cf&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">debugfile&nbsp;</code><code class="bash plain">/var/log/ha-debug</code></div><div class="line number3 index2 alt2"><code class="bash plain">logfile&nbsp;</code><code class="bash plain">/var/log/ha-log</code></div><div class="line number4 index3 alt1"><code class="bash plain">logfacility&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local0</code></div><div class="line number5 index4 alt2"><code class="bash plain">keepalive&nbsp;2</code></div><div class="line number6 index5 alt1"><code class="bash plain">deadtime&nbsp;10</code></div><div class="line number7 index6 alt2"><code class="bash plain">warntime&nbsp;6</code></div><div class="line number8 index7 alt1"><code class="bash comments">#initdead&nbsp;120</code></div><div class="line number9 index8 alt2"><code class="bash plain">udpport&nbsp;694</code></div><div class="line number10 index9 alt1"><code class="bash comments">#bcast&nbsp;em2</code></div><div class="line number11 index10 alt2"><code class="bash plain">mcast&nbsp;em2&nbsp;225.0.0.192&nbsp;694&nbsp;1&nbsp;0</code></div><div class="line number12 index11 alt1"><code class="bash plain">auto_failback&nbsp;on</code></div><div class="line number13 index12 alt2"><code class="bash plain">respawn&nbsp;hacluster&nbsp;</code><code class="bash plain">/usr/lib64/heartbeat/ipfail</code></div><div class="line number14 index13 alt1"><code class="bash plain">node&nbsp;&nbsp;&nbsp;&nbsp;M1.redhat.sx</code></div><div class="line number15 index14 alt2"><code class="bash plain">node&nbsp;&nbsp;&nbsp;&nbsp;M2.redhat.sx</code></div><div class="line number16 index15 alt1"><code class="bash functions">ping</code>&nbsp;<code class="bash plain">192.168.0.1</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">b、authkeys<strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;">&nbsp;</span>文件</span></strong></span></strong></span></p><div><div id="highlighter_157416" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;cat&nbsp;authkeys&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">auth&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;采用何种加密方式</code></div><div class="line number3 index2 alt2"><code class="bash plain">1&nbsp;crc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;无加密</code></div><div class="line number4 index3 alt1"><code class="bash comments">#2&nbsp;sha1&nbsp;HI!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;启用sha1的加密方式</code></div><div class="line number5 index4 alt2"><code class="bash comments">#3&nbsp;md5&nbsp;Hello!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;采用md5的加密方式</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;chmod&nbsp;600&nbsp;authkeys&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;该文件必须设置为600权限，不然heartbeat启动会报错</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">c、haresources<strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;">&nbsp;</span>文件</span></strong></span></strong></span></p><div><div id="highlighter_31341" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;cat&nbsp;haresources&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">M1.redhat.sx&nbsp;IPaddr::192.168.0.219</code><code class="bash plain">/24/em1</code></div><div class="line number3 index2 alt2"><code class="bash comments">#NFS&nbsp;IPaddr::192.168.0.219/24/em1&nbsp;drbddisk::data&nbsp;Filesystem::/dev/drbd0::/data::ext4&nbsp;rpcbind&nbsp;nfsd</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">注意：<span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;line-height:1.5;background-color:rgb(255,255,255);">这个里的nfsd并不是heartbeat自带的，需要自己编写。</span></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;针对该脚本的编写需要满足一下需求：</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1、有可执行权限</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2、必须存放在/<span style="font-family:&#39;微软雅黑&#39;;color:rgb(0,0,0);font-size:14px;line-height:1.5;background-color:rgb(255,255,255);">etc/ha.d/resource.d或/etc/init.d目录下</span></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3、必须有start、stop这两个功能</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;具体脚本信息，下文会写。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">4、启动heartbeat</span></strong></span></p><div><div id="highlighter_353071" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;start&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Starting&nbsp;High-Availability&nbsp;services:&nbsp;INFO:&nbsp;Resource&nbsp;is&nbsp;stopped&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Done.</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;chkconfig&nbsp;heartbeat&nbsp;off</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">说明：关闭开机自启动。当服务重启时，需要人工去启动。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">5、测试heartbeat</span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">在此步测试之前，请先在 M2 上操作如上步骤！</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">a、正常状态</span></strong></span></p><div><div id="highlighter_759636" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;&nbsp;之前在heartbeat资源文件中定义的&nbsp;VIP</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M2&nbsp;ha.d]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">说<span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">明：M1主节点拥有vip地址，M2节点没有。</span></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">b、模拟主节点宕机后的状态</span></strong></span></p><div><div id="highlighter_79528" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;stop&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Stopping&nbsp;High-Availability&nbsp;services:&nbsp;Done.&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@M2&nbsp;ha.d]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">说明：M1宕机后，VIP地址漂移到M2节点上，M2节点成为主节点</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">c、模拟</span></strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:rgb(255,255,255);"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">主节点故障恢复后的状态</span></strong></span></span></p><div><div id="highlighter_260397" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;start&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Starting&nbsp;High-Availability&nbsp;services:&nbsp;INFO:&nbsp;Resource&nbsp;is&nbsp;stopped&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Done.&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">说明：M1节点恢复之后，又抢占回了VIP资源</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"></span></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;"><br></strong></span></strong></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">四、DRBD安装部署</strong></span></strong></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">1、新添加（初始）硬盘</span></strong></span></strong></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">过程略</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">2、安装drbd</span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">针对drbd的安装，我们不仅可以使用yum的方式，还可以使用编译安装的方式。由于我在操作的时候，无法从当前yum源取得drbd的rpm包，因此我就采用了编译的安装方式。</span></p><div><div id="highlighter_190279" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;yum&nbsp;-y&nbsp;install&nbsp;gcc&nbsp;gcc-c++&nbsp;kernel-devel&nbsp;kernel-headers&nbsp;flex&nbsp;make</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cd&nbsp;/usr/local/src</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@M1&nbsp;src]</code><code class="bash comments">#&nbsp;wget&nbsp;http://oss.linbit.com/drbd/8.4/drbd-8.4.3.tar.gz&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M1&nbsp;src]</code><code class="bash comments">#&nbsp;tar&nbsp;zxf&nbsp;drbd-8.4.3.tar.gz&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;src]</code><code class="bash comments">#&nbsp;cd&nbsp;drbd-8.4.3&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;./configure&nbsp;--prefix=/usr/local/drbd&nbsp;--with-km&nbsp;--with-heartbeat&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;make&nbsp;KDIR=/usr/src/kernels/2.6.32-504.el6.x86_64/</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;make&nbsp;install</code></div><div class="line number9 index8 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;mkdir&nbsp;-p&nbsp;/usr/local/drbd/var/run/drbd&nbsp;</code></div><div class="line number10 index9 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;cp&nbsp;/usr/local/drbd/etc/rc.d/init.d/drbd&nbsp;/etc/init.d/&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;chmod&nbsp;+x&nbsp;/etc/init.d/drbd&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;modprobe&nbsp;drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;执行命令加载drbd模块到内核</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@M1&nbsp;ha.d]</code><code class="bash comments">#&nbsp;lsmod|grep&nbsp;drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;检查drbd是否被正确的加载到内核</code></div><div class="line number14 index13 alt1"><code class="bash plain">drbd&nbsp;310236&nbsp;3&nbsp;</code></div><div class="line number15 index14 alt2"><code class="bash plain">libcrc32c&nbsp;1246&nbsp;1&nbsp;drbd</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">3、配置DRBD</span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">有关DRBD涉及到的配置文件主要是<span style="font-family:&#39;微软雅黑&#39;;color:rgb(0,0,0);font-size:14px;line-height:1.5;background-color:rgb(255,255,255);">global_common.conf和用户自定义的资源文件（当然，该资源文件可以写到<span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;line-height:1.5;">global_common.conf中</span>）。</span></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">注意：M1和M2这两个主备节点的以下配置文件完全一样</span></p><div><div id="highlighter_402827" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/usr/local/drbd/etc/drbd.d/global_common.conf&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">global&nbsp;{</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">usage-count&nbsp;no;&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">}&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">common&nbsp;{&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">protocol&nbsp;C;&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">disk&nbsp;{&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">on-io-error&nbsp;detach;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;配置I/O错误处理策略为分离</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">no-disk-flushes;&nbsp;</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">no-md-flushes;&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">net&nbsp;{&nbsp;</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">cram-hmac-alg&nbsp;</code><code class="bash string">"sha1"</code><code class="bash plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;设置加密算法&nbsp;</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">shared-secret&nbsp;</code><code class="bash string">"allendrbd"</code><code class="bash plain">;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;设置加密密钥</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">sndbuf-size&nbsp;512k;</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">max-buffers&nbsp;8000;</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">unplug-watermark&nbsp;1024;</code></div><div class="line number18 index17 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">max-epoch-size&nbsp;8000;</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">after-sb-0pri&nbsp;disconnect;</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">after-sb-1pri&nbsp;disconnect;</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">after-sb-2pri&nbsp;disconnect;</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">rr-conflict&nbsp;disconnect;</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}&nbsp;</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">syncer&nbsp;{&nbsp;</code></div><div class="line number25 index24 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">rate&nbsp;1024M;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;设置主备节点同步时的网络速率</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">al-extents&nbsp;517;</code></div><div class="line number27 index26 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number28 index27 alt1"><code class="bash plain">}</code></div><div class="line number29 index28 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/usr/local/drbd/etc/drbd.d/drbd.res</code></div><div class="line number30 index29 alt1"><code class="bash plain">resource&nbsp;drbd&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;定义一个drbd的资源名</code></div><div class="line number31 index30 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">on&nbsp;M1.redhat.sx&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;主机说明以on开头，后面跟主机名称</code></div><div class="line number32 index31 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">device&nbsp;</code><code class="bash plain">/dev/drbd0</code><code class="bash plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;drbd设备名称</code></div><div class="line number33 index32 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">disk&nbsp;</code><code class="bash plain">/dev/mapper/VolGroup-lv_drbd</code><code class="bash plain">;&nbsp;</code><code class="bash comments">#&nbsp;drbd0&nbsp;使用的是逻辑卷/dev/mapper/VolGroup-lv_drbd</code></div><div class="line number34 index33 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">address&nbsp;172.16.100.210:7789;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;设置DRBD监听地址与端口</code></div><div class="line number35 index34 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">meta-disk&nbsp;internal;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp;设置元数据盘为内部模式</code></div><div class="line number36 index35 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}&nbsp;</code></div><div class="line number37 index36 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">on&nbsp;M2.redhat.sx&nbsp;{&nbsp;</code></div><div class="line number38 index37 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">device&nbsp;</code><code class="bash plain">/dev/drbd0</code><code class="bash plain">;&nbsp;</code></div><div class="line number39 index38 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">disk&nbsp;</code><code class="bash plain">/dev/mapper/VolGroup-lv_drbd</code><code class="bash plain">;&nbsp;</code></div><div class="line number40 index39 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">address&nbsp;172.16.100.211:7789;&nbsp;</code></div><div class="line number41 index40 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">meta-disk&nbsp;internal;&nbsp;</code></div><div class="line number42 index41 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}&nbsp;</code></div><div class="line number43 index42 alt2"><code class="bash plain">}</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">4、初始化meta分区</span></strong></span></strong></span></p><div><div id="highlighter_997616" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;drbdadm&nbsp;create-md&nbsp;drbd&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Writing&nbsp;meta&nbsp;data...&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">initializing&nbsp;activity&nbsp;log&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">NOT&nbsp;initializing&nbsp;bitmap&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">New&nbsp;drbd&nbsp;meta&nbsp;data&nbsp;block&nbsp;successfully&nbsp;created.</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">5、启动drbd服务</span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;line-height:1.5;color:rgb(0,0,0);background-color:rgb(255,255,255);"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">此处，我们可以看下M1 和M2 启动drbd服务前后，drbd设备发生的变化</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_485398" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;启动前&nbsp;drbd&nbsp;设备信息</code></div><div class="line number2 index1 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;drbdadm&nbsp;up&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;启动drbd，这里也可以使用脚本去启动</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;启动后&nbsp;drbd&nbsp;设备信息</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:Inconsistent</code><code class="bash plain">/Inconsistent</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:0&nbsp;nr:0&nbsp;dw:0&nbsp;dr:0&nbsp;al:0&nbsp;bm:0&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:133615596</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_96236" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;drbdadm&nbsp;up&nbsp;all&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:Inconsistent</code><code class="bash plain">/Inconsistent</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:0&nbsp;nr:0&nbsp;dw:0&nbsp;dr:0&nbsp;al:0&nbsp;bm:0&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:133615596</code></div></div></td></tr></tbody></table></div></div><p><br></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">6、初始化设备同步,并确立主节点（覆盖备节点，保持数据一致）</span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_297988" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;drbdadm&nbsp;--&nbsp;--overwrite-data-of-peer&nbsp;primary&nbsp;drbd&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">0:&nbsp;cs:SyncSource&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/Inconsistent</code>&nbsp;<code class="bash plain">C&nbsp;r---n-&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">ns:140132&nbsp;nr:0&nbsp;dw:0&nbsp;dr:144024&nbsp;al:0&nbsp;bm:8&nbsp;lo:0&nbsp;pe:17&nbsp;ua:26&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:133477612&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">[&gt;....................]&nbsp;</code><code class="bash functions">sync</code><code class="bash plain">'ed:&nbsp;0.2%&nbsp;(130348</code><code class="bash plain">/130480</code><code class="bash plain">)M&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">finish:&nbsp;0:16:07&nbsp;speed:&nbsp;137,984&nbsp;(137,984)&nbsp;K</code><code class="bash plain">/sec</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_458030" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">0:&nbsp;cs:SyncTarget&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:Inconsistent</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">ns:0&nbsp;nr:461440&nbsp;dw:461312&nbsp;dr:0&nbsp;al:0&nbsp;bm:28&nbsp;lo:2&nbsp;pe:75&nbsp;ua:1&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:133154284&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">[&gt;....................]&nbsp;</code><code class="bash functions">sync</code><code class="bash plain">'ed:&nbsp;0.4%&nbsp;(130032</code><code class="bash plain">/130480</code><code class="bash plain">)M&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">finish:&nbsp;0:19:13&nbsp;speed:&nbsp;115,328&nbsp;(115,328)&nbsp;want:&nbsp;102,400&nbsp;K</code><code class="bash plain">/sec</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">同步完毕之后状态：</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong></span></p><div><div id="highlighter_234959" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">ns:133615596&nbsp;nr:0&nbsp;dw:0&nbsp;dr:133616260&nbsp;al:0&nbsp;bm:8156&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_537842" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">ns:0&nbsp;nr:133615596&nbsp;dw:133615596&nbsp;dr:0&nbsp;al:0&nbsp;bm:8156&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">7、挂载drbd分区到data数据目录</span></strong></span></strong></span></p><div><div id="highlighter_548276" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;mkfs.ext4&nbsp;/dev/drbd0&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">mke2fs&nbsp;1.41.12&nbsp;(17-May-2010)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Filesystem&nbsp;label=&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">OS&nbsp;</code><code class="bash functions">type</code><code class="bash plain">:&nbsp;Linux&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">Block&nbsp;size=4096&nbsp;(log=2)&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">Fragment&nbsp;size=4096&nbsp;(log=2)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">Stride=0&nbsp;blocks,&nbsp;Stripe&nbsp;width=0&nbsp;blocks&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">8355840&nbsp;inodes,&nbsp;33403899&nbsp;blocks&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">1670194&nbsp;blocks&nbsp;(5.00%)&nbsp;reserved&nbsp;</code><code class="bash keyword">for</code>&nbsp;<code class="bash plain">the&nbsp;super&nbsp;user&nbsp;</code></div><div class="line number10 index9 alt1"><code class="bash plain">First&nbsp;data&nbsp;block=0&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash plain">Maximum&nbsp;filesystem&nbsp;blocks=4294967296&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">1020&nbsp;block&nbsp;</code><code class="bash functions">groups</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="bash plain">32768&nbsp;blocks&nbsp;per&nbsp;group,&nbsp;32768&nbsp;fragments&nbsp;per&nbsp;group&nbsp;</code></div><div class="line number14 index13 alt1"><code class="bash plain">8192&nbsp;inodes&nbsp;per&nbsp;group&nbsp;</code></div><div class="line number15 index14 alt2"><code class="bash plain">Superblock&nbsp;backups&nbsp;stored&nbsp;on&nbsp;blocks:&nbsp;</code></div><div class="line number16 index15 alt1"><code class="bash plain">32768,&nbsp;98304,&nbsp;163840,&nbsp;229376,&nbsp;294912,&nbsp;819200,&nbsp;884736,&nbsp;1605632,&nbsp;2654208,&nbsp;</code></div><div class="line number17 index16 alt2"><code class="bash plain">4096000,&nbsp;7962624,&nbsp;11239424,&nbsp;20480000,&nbsp;23887872&nbsp;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash plain">Writing&nbsp;inode&nbsp;tables:&nbsp;</code><code class="bash keyword">done</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="bash plain">Creating&nbsp;journal&nbsp;(32768&nbsp;blocks):&nbsp;</code><code class="bash keyword">done</code>&nbsp;</div><div class="line number21 index20 alt2"><code class="bash plain">Writing&nbsp;superblocks&nbsp;and&nbsp;filesystem&nbsp;accounting&nbsp;information:&nbsp;</code><code class="bash keyword">done</code>&nbsp;</div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="bash plain">This&nbsp;filesystem&nbsp;will&nbsp;be&nbsp;automatically&nbsp;checked&nbsp;every&nbsp;21&nbsp;mounts&nbsp;or&nbsp;</code></div><div class="line number24 index23 alt1"><code class="bash plain">180&nbsp;days,&nbsp;whichever&nbsp;comes&nbsp;first.&nbsp;Use&nbsp;tune2fs&nbsp;-c&nbsp;or&nbsp;-i&nbsp;to&nbsp;override.</code></div><div class="line number25 index24 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;mount&nbsp;/dev/drbd0&nbsp;/data/</code></div><div class="line number26 index25 alt1"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;df&nbsp;-h</code></div><div class="line number27 index26 alt2"><code class="bash plain">Filesystem&nbsp;Size&nbsp;Used&nbsp;Avail&nbsp;Use%&nbsp;Mounted&nbsp;on&nbsp;</code></div><div class="line number28 index27 alt1"><code class="bash plain">/dev/mapper/VolGroup-lv_root</code>&nbsp;</div><div class="line number29 index28 alt2"><code class="bash plain">50G&nbsp;5.6G&nbsp;42G&nbsp;12%&nbsp;/&nbsp;</code></div><div class="line number30 index29 alt1"><code class="bash plain">tmpfs&nbsp;7.8G&nbsp;0&nbsp;7.8G&nbsp;0%&nbsp;</code><code class="bash plain">/dev/shm</code>&nbsp;</div><div class="line number31 index30 alt2"><code class="bash plain">/dev/sda1</code>&nbsp;<code class="bash plain">477M&nbsp;46M&nbsp;406M&nbsp;11%&nbsp;</code><code class="bash plain">/boot</code>&nbsp;</div><div class="line number32 index31 alt1"><code class="bash plain">/dev/drbd0</code>&nbsp;<code class="bash plain">126G&nbsp;60M&nbsp;119G&nbsp;1%&nbsp;</code><code class="bash plain">/data</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">8、测试主节点写入，备节点是否能同步</span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M1端：</span></strong><br></span></p><div><div id="highlighter_99210" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;dd&nbsp;if=/dev/zero&nbsp;of=/data/test&nbsp;bs=1G&nbsp;count=1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">1+0&nbsp;records&nbsp;</code><code class="bash keyword">in</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="bash plain">1+0&nbsp;records&nbsp;out&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">1073741824&nbsp;bytes&nbsp;(1.1&nbsp;GB)&nbsp;copied,&nbsp;1.26333&nbsp;s,&nbsp;850&nbsp;MB</code><code class="bash plain">/s</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:135840788&nbsp;nr:0&nbsp;dw:2225192&nbsp;dr:133617369&nbsp;al:619&nbsp;bm:8156&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div><div class="line number10 index9 alt1"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;umount&nbsp;/data/</code></div><div class="line number11 index10 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;drbdadm&nbsp;down&nbsp;drbd&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;关闭名字为drbd的资源</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">M2端：</span></strong><br></span></p><div><div id="highlighter_187909" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;主节点关闭资源之后，查看备节点的信息，可以看到主节点的角色已经变为UnKnown</code></div><div class="line number2 index1 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">0:&nbsp;cs:WFConnection&nbsp;ro:Secondary</code><code class="bash plain">/Unknown</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/DUnknown</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">ns:0&nbsp;nr:136889524&nbsp;dw:136889524&nbsp;dr:0&nbsp;al:0&nbsp;bm:8156&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;drbdadm&nbsp;primary&nbsp;drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;确立自己的角色为primary，即主节点</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;mount&nbsp;/dev/drbd0&nbsp;/data</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cd&nbsp;/data&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">[root@M2&nbsp;data]</code><code class="bash comments">#&nbsp;ls&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;发现数据还在</code></div><div class="line number10 index9 alt1"><code class="bash plain">lost+found&nbsp;</code><code class="bash functions">test</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="bash plain">[root@M2&nbsp;data]</code><code class="bash comments">#&nbsp;du&nbsp;-sh&nbsp;test&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">1.1G&nbsp;</code><code class="bash functions">test</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@M2&nbsp;data]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;查看当前&nbsp;drbd&nbsp;设备信息</code></div><div class="line number14 index13 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number15 index14 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number16 index15 alt1"><code class="bash plain">0:&nbsp;cs:WFConnection&nbsp;ro:Primary</code><code class="bash plain">/Unknown</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/DUnknown</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number17 index16 alt2"><code class="bash plain">ns:0&nbsp;nr:136889524&nbsp;dw:136889548&nbsp;dr:1045&nbsp;al:3&nbsp;bm:8156&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:24</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"></span></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;"><br></strong></span></strong></span></strong></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">五、NFS安装部署</strong></span></strong></span></strong></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, sans-serif;color:rgb(0,112,192);font-size:3px;"></span></strong></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">该操作依旧仅以M1为例，M2操作亦如此。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"></span></p><p><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">1、安装nfs</span></strong></span></strong></span></strong></p><div><div id="highlighter_759062" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;yum&nbsp;install&nbsp;nfs-utils&nbsp;rpcbind&nbsp;-y</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;yum&nbsp;install&nbsp;nfs-utils&nbsp;rpcbind&nbsp;-y</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">2、配置 nfs 共享目录</span></strong></span></strong></span></strong></span></p><div><div id="highlighter_321275" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;cat&nbsp;/etc/exports&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">/data</code>&nbsp;<code class="bash plain">192.168.0.0</code><code class="bash plain">/24</code><code class="bash plain">(rw,</code><code class="bash functions">sync</code><code class="bash plain">,no_root_squash,anonuid=0,anongid=0)</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/etc/exports&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">/data</code>&nbsp;<code class="bash plain">192.168.0.0</code><code class="bash plain">/24</code><code class="bash plain">(rw,</code><code class="bash functions">sync</code><code class="bash plain">,no_root_squash,anonuid=0,anongid=0)</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">3、启动 rpcbind 和 nfs 服务</span></strong></span></strong></span></strong></span></p><p><span style="line-height:0px;"></span></p><div><div id="highlighter_474921" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;/etc/init.d/rpcbind&nbsp;start;chkconfig&nbsp;rpcbind&nbsp;off&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@M1&nbsp;drbd]</code><code class="bash comments">#&nbsp;/etc/init.d/nfs&nbsp;start;chkconfig&nbsp;nfs&nbsp;off&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Starting&nbsp;NFS&nbsp;services:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">Starting&nbsp;NFS&nbsp;quotas:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">Starting&nbsp;NFS&nbsp;mountd:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">Starting&nbsp;NFS&nbsp;daemon:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">Starting&nbsp;RPC&nbsp;idmapd:&nbsp;[&nbsp;OK&nbsp;]</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@M2&nbsp;drbd]</code><code class="bash comments">#&nbsp;/etc/init.d/rpcbind&nbsp;start;chkconfig&nbsp;rpcbind&nbsp;off&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">[root@M2&nbsp;drbd]</code><code class="bash comments">#&nbsp;/etc/init.d/nfs&nbsp;start;chkconfig&nbsp;nfs&nbsp;off&nbsp;</code></div><div class="line number10 index9 alt1"><code class="bash plain">Starting&nbsp;NFS&nbsp;services:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash plain">Starting&nbsp;NFS&nbsp;quotas:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">Starting&nbsp;NFS&nbsp;mountd:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number13 index12 alt2"><code class="bash plain">Starting&nbsp;NFS&nbsp;daemon:&nbsp;[&nbsp;OK&nbsp;]&nbsp;</code></div><div class="line number14 index13 alt1"><code class="bash plain">Starting&nbsp;RPC&nbsp;idmapd:&nbsp;[&nbsp;OK&nbsp;]192</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">4、测试 nfs</span></strong></span></strong></span></strong></span></p><div><div id="highlighter_199133" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@C1&nbsp;~]&nbsp;</code><code class="bash comments">#&nbsp;mount&nbsp;-t&nbsp;nfs&nbsp;-o&nbsp;noatime,nodiratime&nbsp;192.168.0.219:/data&nbsp;/xxxxx/&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">[root@C1&nbsp;~]&nbsp;</code><code class="bash comments">#&nbsp;df&nbsp;-h|grep&nbsp;data&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">192.168.0.219:</code><code class="bash plain">/data</code>&nbsp;<code class="bash plain">126G&nbsp;1.1G&nbsp;118G&nbsp;1%&nbsp;</code><code class="bash plain">/data</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@C1&nbsp;~]&nbsp;</code><code class="bash comments">#&nbsp;cd&nbsp;/data</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@C1&nbsp;data]&nbsp;</code><code class="bash comments">#&nbsp;ls&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">lost+found&nbsp;</code><code class="bash functions">test</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="bash plain">[root@C1&nbsp;data]&nbsp;</code><code class="bash comments">#&nbsp;echo&nbsp;'nolinux'&nbsp;&gt;&gt;&nbsp;nihao</code></div><div class="line number8 index7 alt1"><code class="bash plain">[root@C1&nbsp;data]&nbsp;</code><code class="bash comments">#&nbsp;ls&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">lost+found&nbsp;nihao&nbsp;</code><code class="bash functions">test</code></div><div class="line number10 index9 alt1"><code class="bash plain">[root@C1&nbsp;data]&nbsp;</code><code class="bash comments">#&nbsp;cat&nbsp;nihao&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash plain">nolinux</code></div></div></td></tr></tbody></table></div></div><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;color:rgb(0,0,0);background-color:rgb(255,255,255);"><br style="background-color:inherit;"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:16px;color:rgb(255,0,0);background-color:inherit;"><strong style="background-color:inherit;">六、整合Heartbeat、DRBD和NFS服务</strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;;color:rgb(0,0,0);font-size:14px;font-weight:normal;line-height:1.5;background-color:rgb(255,255,255);">注意，一下修改的heartbeat的文件和脚本都需要在M1和M2上保持相同配置！<br style="background-color:inherit;"></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">1、修改 heartbeat 资源定义文件</span></strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">修改heartbeat的资源定义文件，添加对drbd服务、磁盘挂载、nfs服务的自动管理，修改结果如下：</span></p><div><div id="highlighter_328041" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/etc/ha.d/haresources</code></div><div class="line number2 index1 alt1"><code class="bash plain">M1.redhat.sx&nbsp;IPaddr::192.168.0.219</code><code class="bash plain">/24/em1</code>&nbsp;<code class="bash plain">drbddisk::drbd&nbsp;Filesystem::</code><code class="bash plain">/dev/drbd0</code><code class="bash plain">::</code><code class="bash plain">/data</code><code class="bash plain">::ext4&nbsp;nfsd</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">这里需要注意的是，配置文件中使用的IPaddr、drbddisk都是存在于/etc/ha.d/resource.d/目录下的，该目录下自带了很多服务管理脚本，来提供给heartbeat服务调用。而后面的nfsd，默认heartbeat是不带的，这里附上该脚本。</span></p><div><div id="highlighter_26889" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;/]</code><code class="bash comments">#&nbsp;vim&nbsp;/etc/ha.d/resource.d/nfsd</code></div><div class="line number2 index1 alt1"><code class="bash comments">#!/bin/bash</code></div><div class="line number3 index2 alt2"><code class="bash comments">#</code></div><div class="line number4 index3 alt1"><code class="bash keyword">case</code>&nbsp;<code class="bash plain">$1&nbsp;</code><code class="bash keyword">in</code></div><div class="line number5 index4 alt2"><code class="bash plain">start)</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">/etc/init</code><code class="bash plain">.d</code><code class="bash plain">/nfs</code>&nbsp;<code class="bash plain">restart</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">;;</code></div><div class="line number8 index7 alt1"><code class="bash plain">stop)</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">for</code>&nbsp;<code class="bash plain">proc&nbsp;</code><code class="bash keyword">in</code>&nbsp;<code class="bash plain">rpc.mountd&nbsp;rpc.rquotad&nbsp;nfsd&nbsp;nfsd</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">do</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">killall&nbsp;-9&nbsp;$proc</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">done</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">;;</code></div><div class="line number14 index13 alt1"><code class="bash keyword">esac</code></div><div class="line number15 index14 alt2"><code class="bash plain">[root@M1&nbsp;/]</code><code class="bash comments">#&nbsp;chmod&nbsp;755&nbsp;/etc/ha.d/resource.d/nfsd</code></div></div></td></tr></tbody></table></div></div><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">虽然，系统自带了nfs的启动脚本，但是在 heartbeat 调用时无法彻底杀死 nfs 进程，因此才需要我们自己编写启动脚本。</span></p><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><br style="background-color:inherit;"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">2、重启heartbeat，启动 NFS 高可用</span></strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">一下操作，最好按顺序！</span></p><div><div id="highlighter_934645" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;stop&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Stopping&nbsp;High-Availability&nbsp;services:&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Done.&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;stop&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">Stopping&nbsp;High-Availability&nbsp;services:&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">Done.&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;start&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">Starting&nbsp;High-Availability&nbsp;services:&nbsp;INFO:&nbsp;Resource&nbsp;is&nbsp;stopped&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">Done.</code></div><div class="line number10 index9 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;start&nbsp;</code></div><div class="line number11 index10 alt2"><code class="bash plain">Starting&nbsp;High-Availability&nbsp;services:&nbsp;INFO:&nbsp;Resource&nbsp;is&nbsp;stopped&nbsp;</code></div><div class="line number12 index11 alt1"><code class="bash plain">Done.</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number14 index13 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number15 index14 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number16 index15 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1</code></div><div class="line number17 index16 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a&nbsp;|grep&nbsp;em1&nbsp;</code></div><div class="line number18 index17 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number19 index18 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1</code></div><div class="line number20 index19 alt1"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number21 index20 alt2"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number22 index21 alt1"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number23 index22 alt2"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number24 index23 alt1"><code class="bash plain">ns:24936&nbsp;nr:13016&nbsp;dw:37920&nbsp;dr:17307&nbsp;al:15&nbsp;bm:5&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div><div class="line number25 index24 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number26 index25 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number27 index26 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number28 index27 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number29 index28 alt2"><code class="bash plain">ns:84&nbsp;nr:24&nbsp;dw:37896&nbsp;dr:10589&nbsp;al:14&nbsp;bm:5&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div><div class="line number30 index29 alt1"><code class="bash plain">C1&nbsp;端挂载测试：</code></div><div class="line number31 index30 alt2"><code class="bash plain">[root@C1&nbsp;~]&nbsp;</code><code class="bash comments">#&nbsp;mount&nbsp;192.168.0.219:/data&nbsp;/data&nbsp;</code></div><div class="line number32 index31 alt1"><code class="bash plain">[root@C1&nbsp;~]&nbsp;</code><code class="bash comments">#&nbsp;df&nbsp;-h&nbsp;|grep&nbsp;data</code></div><div class="line number33 index32 alt2"><code class="bash plain">192.168.0.219:</code><code class="bash plain">/data</code>&nbsp;<code class="bash plain">126G&nbsp;60M&nbsp;119G&nbsp;1%&nbsp;</code><code class="bash plain">/data</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">OK，可以看出C1客户端能够通过VIP成功挂载NFS高可用存储共享出来的NFS服务。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">3、测试</span></strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;">这里，将进行对NFS高可用集群进行测试，看遇到故障之后，是否服务能够正常切换。</span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">a、测试关闭heartbeat服务后，nfs服务是否正常</span></strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);"><strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端heartbeat服务宕前，M1端状态：</span></strong></span></strong></span></p><div><div id="highlighter_208451" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:8803768&nbsp;nr:3736832&nbsp;dw:12540596&nbsp;dr:5252&nbsp;al:2578&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;line-height:1.5;color:rgb(0,0,0);background-color:rgb(255,255,255);"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);"><strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端heartbeat服务宕前，</span></strong></span></strong>M2端状态：</span></strong></span></p><div><div id="highlighter_934730" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">ns:4014352&nbsp;nr:11417156&nbsp;dw:15431508&nbsp;dr:5941&nbsp;al:1168&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="color:rgb(0,0,0);font-size:14px;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;line-height:1.5;background-color:rgb(255,255,255);"></span><br></p><p><span style="line-height:1.5;font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;color:rgb(0,0,0);background-color:rgb(255,255,255);"></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);"><strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">宕掉</span></strong>M1端heartbeat服务：</span></strong></span></p><div><div id="highlighter_698382" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;stop&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Stopping&nbsp;High-Availability&nbsp;services:&nbsp;Done.</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">M1端heartbeat服务宕后，M1端状态：</span></strong></span></p><div><div id="highlighter_216229" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">ns:11417152&nbsp;nr:4014300&nbsp;dw:15431448&nbsp;dr:7037&nbsp;al:3221&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);"></span><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端heartbeat服务宕后，</span></strong>M2端状态：</span></strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);"></span></strong></span></p><div><div id="highlighter_837078" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:4014300&nbsp;nr:11417152&nbsp;dw:15431452&nbsp;dr:5941&nbsp;al:1168&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">恢复M1端的heartbeat服务，看M2是否回切</span></strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">恢复M1端heartbeat服务：</span></strong><br></span></p><div><div id="highlighter_141820" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;/etc/init.d/heartbeat&nbsp;start&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">Starting&nbsp;High-Availability&nbsp;services:&nbsp;INFO:&nbsp;Resource&nbsp;is&nbsp;stopped&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">Done.</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端heartbeat服务恢复后，M1端状态：</span></strong><br></span></p><div><div id="highlighter_569832" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:11417156&nbsp;nr:4014352&nbsp;dw:15431504&nbsp;dr:7874&nbsp;al:3221&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端heartbeat服务恢复后，M2端状态：</span></strong><br></span></p><div><div id="highlighter_817011" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">ns:4014352&nbsp;nr:11417156&nbsp;dw:15431508&nbsp;dr:5941&nbsp;al:1168&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><br style="background-color:inherit;"></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">C1端针对NFS切换的受影响效果分析：</span></strong></span></p><div><div id="highlighter_873843" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@C1&nbsp;~]&nbsp;</code><code class="bash comments">#&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;`seq&nbsp;1&nbsp;10000`;do&nbsp;dd&nbsp;if=/dev/zero&nbsp;of=/data/test$i&nbsp;bs=10M&nbsp;count=1;stat&nbsp;/data/test$i|grep&nbsp;'Access:&nbsp;2014';done&nbsp;&nbsp;&nbsp;#&nbsp;这里仅仅截取部分输出</code></div><div class="line number2 index1 alt1"><code class="bash plain">1+0&nbsp;records&nbsp;</code><code class="bash keyword">in</code></div><div class="line number3 index2 alt2"><code class="bash plain">1+0&nbsp;records&nbsp;out</code></div><div class="line number4 index3 alt1"><code class="bash plain">10485760&nbsp;bytes&nbsp;(10&nbsp;MB)&nbsp;copied,&nbsp;15.1816&nbsp;s,&nbsp;691&nbsp;kB</code><code class="bash plain">/s</code></div><div class="line number5 index4 alt2"><code class="bash plain">Access:&nbsp;2014-11-12&nbsp;23:26:15.945546803&nbsp;+0800</code></div><div class="line number6 index5 alt1"><code class="bash plain">1+0&nbsp;records&nbsp;</code><code class="bash keyword">in</code></div><div class="line number7 index6 alt2"><code class="bash plain">1+0&nbsp;records&nbsp;out</code></div><div class="line number8 index7 alt1"><code class="bash plain">10485760&nbsp;bytes&nbsp;(10&nbsp;MB)&nbsp;copied,&nbsp;0.20511&nbsp;s,&nbsp;51.1&nbsp;MB</code><code class="bash plain">/s</code></div><div class="line number9 index8 alt2"><code class="bash plain">Access:&nbsp;2014-11-12&nbsp;23:28:11.687931979&nbsp;+0800</code></div><div class="line number10 index9 alt1"><code class="bash plain">1+0&nbsp;records&nbsp;</code><code class="bash keyword">in</code></div><div class="line number11 index10 alt2"><code class="bash plain">1+0&nbsp;records&nbsp;out</code></div><div class="line number12 index11 alt1"><code class="bash plain">10485760&nbsp;bytes&nbsp;(10&nbsp;MB)&nbsp;copied,&nbsp;0.20316&nbsp;s,&nbsp;51.6&nbsp;MB</code><code class="bash plain">/s</code></div><div class="line number13 index12 alt2"><code class="bash plain">Access:&nbsp;2014-11-12&nbsp;23:28:11.900936657&nbsp;+0800</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:22px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(255,0,0);font-size:14px;background-color:inherit;">注意：</span></strong></span>目测，NFS必须需要2分钟的延迟。测试了很多方法，这个问题目前尚未解决！</span></p><p><br></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;background-color:inherit;"><strong style="background-color:inherit;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,112,192);font-size:14px;background-color:inherit;">b、测试关闭心跳线之外的网络后，nfs服务是否正常</span></strong></span></strong></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端em1网口宕前</span></strong></span></strong><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">，M1端状态：</span></strong></span></strong><br></span></p><div><div id="highlighter_130430" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:11417156&nbsp;nr:4014352&nbsp;dw:15431504&nbsp;dr:7874&nbsp;al:3221&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);">宕掉M1端的em1网口：</span></strong></span></p><div><div id="highlighter_268627" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ifdown&nbsp;em1</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:rgb(255,255,255);"><strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端em1网口宕</span></strong></span></strong><strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">后，M1端状态：（</span></strong></span></strong>在M2端上通过心跳线，SSH到M1端）</span></strong></span></p><div><div id="highlighter_940145" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;DOWN&nbsp;qlen&nbsp;1000</code></div><div class="line number3 index2 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">ns:11993288&nbsp;nr:4024660&nbsp;dw:16017944&nbsp;dr:8890&nbsp;al:3222&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">M1端em1网口宕</span></strong></span></strong><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><strong style="color:rgb(0,0,0);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">后，M2端状态：</span></strong></span></strong></span></strong><br></span></p><div><div id="highlighter_782407" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:4024620&nbsp;nr:11993288&nbsp;dw:16017908&nbsp;dr:7090&nbsp;al:1171&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="background-color:rgb(255,255,255);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;"><br style="background-color:inherit;"></span></strong></span></p><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="background-color:rgb(255,255,255);line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;">恢复M1端的em1网口：</span></strong></span></p><div><div id="highlighter_628633" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ifup&nbsp;em1</code></div></div></td></tr></tbody></table></div></div><p><span style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;"><strong><strong style="color:rgb(0,0,0);font-family:&#39;微软雅黑&#39;;font-size:14px;line-height:1.5;background-color:rgb(255,255,255);"><span style="color:rgb(227,108,9);font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;font-size:14px;background-color:inherit;">恢复M1端的em1网口，M1端状态：</span></strong><br></strong></span></p><div><div id="highlighter_599785" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a&nbsp;|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.210</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">inet&nbsp;192.168.0.219</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;secondary&nbsp;em1&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">[root@M1&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M1.redhat.sx,&nbsp;2014-11-11&nbsp;16:20:26&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Primary</code><code class="bash plain">/Secondary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number9 index8 alt2"><code class="bash plain">ns:11993292&nbsp;nr:4024680&nbsp;dw:16017968&nbsp;dr:9727&nbsp;al:3222&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div><p><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(0,0,0);font-size:14px;"><strong style="line-height:1.5;"><span style="font-family:&#39;微软雅黑&#39;, &#39;Microsoft YaHei&#39;;color:rgb(227,108,9);font-size:14px;background-color:inherit;">恢复M1端的em1网口，M2端状态：</span></strong><br style="background-color:inherit;"></span></p><div><div id="highlighter_253314" class="syntaxhighlighter  bash"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;ip&nbsp;a|grep&nbsp;em1&nbsp;</code></div><div class="line number2 index1 alt1"><code class="bash plain">2:&nbsp;em1:&nbsp;&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;&nbsp;mtu&nbsp;1500&nbsp;qdisc&nbsp;mq&nbsp;state&nbsp;UP&nbsp;qlen&nbsp;1000&nbsp;</code></div><div class="line number3 index2 alt2"><code class="bash plain">inet&nbsp;192.168.0.211</code><code class="bash plain">/24</code>&nbsp;<code class="bash plain">brd&nbsp;192.168.0.255&nbsp;scope&nbsp;global&nbsp;em1&nbsp;</code></div><div class="line number4 index3 alt1"><code class="bash plain">[root@M2&nbsp;~]</code><code class="bash comments">#&nbsp;cat&nbsp;/proc/drbd&nbsp;</code></div><div class="line number5 index4 alt2"><code class="bash plain">version:&nbsp;8.4.3&nbsp;(api:1</code><code class="bash plain">/proto</code><code class="bash plain">:86-101)&nbsp;</code></div><div class="line number6 index5 alt1"><code class="bash plain">GIT-</code><code class="bash functions">hash</code><code class="bash plain">:&nbsp;89a294209144b68adb3ee85a73221f964d3ee515&nbsp;build&nbsp;by&nbsp;root@M2.redhat.sx,&nbsp;2014-11-11&nbsp;16:25:08&nbsp;</code></div><div class="line number7 index6 alt2"><code class="bash plain">0:&nbsp;cs:Connected&nbsp;ro:Secondary</code><code class="bash plain">/Primary</code>&nbsp;<code class="bash plain">ds:UpToDate</code><code class="bash plain">/UpToDate</code>&nbsp;<code class="bash plain">C&nbsp;r-----&nbsp;</code></div><div class="line number8 index7 alt1"><code class="bash plain">ns:4024680&nbsp;nr:11993292&nbsp;dw:16017972&nbsp;dr:7102&nbsp;al:1171&nbsp;bm:1&nbsp;lo:0&nbsp;pe:0&nbsp;ua:0&nbsp;ap:0&nbsp;ep:1&nbsp;wo:d&nbsp;oos:0</code></div></div></td></tr></tbody></table></div></div>
		  </div>

			




    		

	  </div>
      </div>
    
    </div>
    



    




	







</div>
</div>














	
	
	   
	   
	   
	   
	   
	   
	   
	   
	   
	   
	   
	   
	   
	
	

























</body></html>